<app-menu></app-menu>
<div class="row pt-3 px-5">
    <h3 class="txt-title mt-4">Dashboard</h3>
    <div class="line"></div>
    <div class="row pt-5">
        <div class="col-md-3">
            <div class="card shadow">
                <div class="card-body p-3">
                    <div class="title-card">Total creditos matriculados</div>
                    <div class="text-center pt-3">
                        <span class="txt-result">{{creditosMatriculados}}</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow">
                <div class="card-body p-3">
                    <div class="title-card">Materias por matricular</div>
                    <div class="text-center pt-3">
                        <span class="txt-result">{{3 - materiasMatriculadasList.length }}</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow">
                <div class="card-body p-3">
                    <div class="title-card">Materias existentes</div>
                    <div class="text-center pt-3">
                        <span class="txt-result"><a class="lnk-item" [routerLink]="['/materia']">10</a></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow">
                <div class="card-body p-3">
                    <div class="title-card">Profesores</div>
                    <div class="text-center pt-3">
                        <span class="txt-result"><a class="lnk-item" [routerLink]="['/profesor']">5</a></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @if (!matriculoMaterias && materiasMatriculadasList.length === 0) {
        <div class="row pt-5">
            <h3 class="txt-title mt-4 text-center">No tienes materias matriculadas, ¿Deseas inscribirte a un programa de creditos?</h3>
            <div class="row justify-content-center text-center mt-4">
                <div class="col-2">
                  <button type="button" class="btn btn-custom btn-lg" (click)="mostrarTablaMaterias()">Sí</button>
                </div>
                <div class="col-2">
                    <button type="button" class="btn btn-custom btn-lg" (click)="matriculoMaterias = false">No</button>
                </div>
              </div>
        </div>
    }
    <!-- tabla de registro del estudiante -->
    @if(matriculoMaterias || materiasMatriculadasList.length > 0) {
        <div class="row pt-5">
            <div class="col-12">
                <h3 class="txt-subtitlw mt-4">Mis Materias Asignadas</h3>
            </div>
            <div class="col-12 text-end">
                <button type="button" class="btn btn-custom btn-lg" (click)="mostrarComponenteAgregarMateria()" ><i class="fa-solid fa-plus"></i>Matricular Materias</button>
                <button type="button" class="btn btn-custom btn-lg ms-3" (click)="navigateTo('estudiante')">Ir a Estudiantes <i class="fa-solid fa-arrow-right"></i></button>
            </div>
            @if (mostrarAgregarMateria) {
                <div class="col-12 pt-4">
                    <div class="card p-3">
                        <div class="card-body">
                            <form [formGroup]="materiaForm">
                                <div class="row justify-content-start">
                                    <div class="col-3">
                                        <label for="materia" class="form-label">Materia</label>
                                        <select class="form-select" aria-label="materia" id="materia" formControlName="materia" (change)="seleccionarMateria(materiaForm.get('materia')?.value)" >
                                            <option selected disabled>Seleccione</option>
                                            @for (item of materias; track $index) {
                                                <option [value]="item.id">{{item.codigo}} - {{item.nombre}}</option>
                                            }
                                        </select>
                                    </div>
                                    <div class="d-flex col-3 align-items-center pt-4">
                                        <strong class="me-2">Docente:</strong><span>{{ profesorSeleccionado ?  profesorSeleccionado : ''}}</span>
                                    </div>
                                    <div class="col-3 pt-4">
                                        <button type="button" class="btn btn-custom btn-lg" [disabled]="materiaForm.invalid" (click)="matricularMaterias(materiaForm.get('materia')?.value)"><i class="fa-solid fa-address-book me-1"></i>Matricular</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            }
            <div class="col-12 mt-5">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            @for(item of displayedColumns; track item) {
                            <th scope="col" class="text-center">{{item}}</th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @for(item of paginatedData; track item) {
                        <tr>
                            <td class="text-center fs-6">{{ item.codigo }}</td>
                            <td class="text-center fs-6">{{ item.nombre }}</td>
                            <td class="text-center fs-6">{{ item.creditos }}</td>
                            <td class="text-center fs-6">{{ item.profesor?.nombre +' '+item.profesor?.apellido}}</td>
                            <td class="text-center">
                                <a class="btn" (click)="mostrarDetalle(item)" title="Detalle materia"><i class="fa-regular fa-file-lines fa-2x"></i></a>
                                <a class="btn" (click)="eliminarMaterias(item.id!)" title="Eliminar materia"><i class="fa-solid fa-trash-can fa-2x"></i></a>
                                
                            </tr>
                        }
                    </tbody>
                </table>
                <div class="row justify-content-end mt-4 mb-4">
                    <div class="col-3 text-end mt-4 w-full">
                        <div class="join items-center">
                            <button class="btn bg-transparent border-0 shadow-none"
                                [disabled]="currentPage === 1" (click)="prevPage()">
                                << Anterior
                            </button>
                            @for( page of pages; track page ) {
                            <button class="btn border-0 shadow-none font-light mr-1"
                                [class.btn-active]="currentPage === page" (click)="goToPage(page)">
                                {{ page }}
                            </button>     
                            }
                            <button class="btn bg-transparent border-0 shadow-none"
                                [disabled]="currentPage === totalPages" (click)="nextPage()">
                                Siguiente >>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    
</div>